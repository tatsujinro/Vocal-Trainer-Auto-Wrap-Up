name: è‡ªå‹•æ‰“åŒ…è²æ¨‚æ•™ç·´ HTML

# è§¸ç™¼æ¢ä»¶ï¼šç•¶ main åˆ†æ”¯æœ‰ä»£ç¢¼æ¨é€æ™‚
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # å…è¨±æ‰‹å‹•æŒ‰æŒ‰éˆ•è§¸ç™¼

permissions:
  contents: write # å…è¨±æ©Ÿå™¨äººä¿®æ”¹å€‰åº«å…§å®¹

jobs:
  build:
    runs-on: ubuntu-latest # ä½¿ç”¨ Ubuntu è™›æ“¬æ©Ÿ

    steps:
      # 1. æŠŠå€‰åº«çš„ä»£ç¢¼æŠ“ä¸‹ä¾†
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. å®‰è£ Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. åŸ·è¡Œä½ çš„ Python æ‰“åŒ…è…³æœ¬
      - name: Run Python Builder
        run: |
          # é€™è£¡å¡«å¯«ä½ ä¸Šå‚³çš„ Python æª”åï¼Œä¾‹å¦‚ build_offline_app.py
          python build_offline_app.py

# 4. éƒ¨ç½²èˆ‡å°å­˜ç‰ˆæœ¬ (åˆä½µè™•ç†ï¼Œç¢ºä¿å…©å€‹æª”æ¡ˆéƒ½è¢«ä¸Šå‚³)
      - name: Deploy and Archive Version
        run: |
          # è¨­å®š Git èº«ä»½
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

          # 1. æŠ“å‡ºå‰›ç”¢ç”Ÿçš„ç‰ˆæœ¬æª”æ¡ˆ (ä¾‹å¦‚ v27)
          VERSION_FILE=$(ls VocalTrainer_Offline_*.html | head -n 1)
          echo "ğŸ‘‰ ç™¼ç¾æ–°ç‰ˆæœ¬æª”æ¡ˆ: $VERSION_FILE"

          # 2. è¤‡è£½ä¸€ä»½è®Šæˆ index.html (è¦†è“‹èˆŠçš„)
          cp -f "$VERSION_FILE" index.html

          # 3. ã€é—œéµä¿®æ­£ã€‘æŠŠã€Œç‰ˆæœ¬æª”æ¡ˆã€å’Œã€Œindex.htmlã€é€šé€šåŠ å…¥è¿½è¹¤
          git add "$VERSION_FILE"
          git add index.html

          # 4. æäº¤ä¸¦æ¨é€
          git commit -m "Auto-deploy: $VERSION_FILE" || echo "âš ï¸ æ²’æœ‰åµæ¸¬åˆ°æª”æ¡ˆè®Šå‹•"
          git push
