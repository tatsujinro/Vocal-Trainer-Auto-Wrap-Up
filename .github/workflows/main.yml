name: è‡ªå‹•æ‰“åŒ…è²æ¨‚æ•™ç·´ HTML

# è§¸ç™¼æ¢ä»¶ï¼šç•¶ main åˆ†æ”¯æœ‰ä»£ç¢¼æ¨é€æ™‚
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # å…è¨±æ‰‹å‹•æŒ‰æŒ‰éˆ•è§¸ç™¼

permissions:
  contents: write # å…è¨±æ©Ÿå™¨äººä¿®æ”¹å€‰åº«å…§å®¹

jobs:
  build:
    runs-on: ubuntu-latest # ä½¿ç”¨ Ubuntu è™›æ“¬æ©Ÿ

    steps:
      # 1. æŠŠå€‰åº«çš„ä»£ç¢¼æŠ“ä¸‹ä¾†
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. å®‰è£ Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. åŸ·è¡Œä½ çš„ Python æ‰“åŒ…è…³æœ¬
      - name: Run Python Builder
        run: |
          # é€™è£¡å¡«å¯«ä½ ä¸Šå‚³çš„ Python æª”åï¼Œä¾‹å¦‚ build_offline_app.py
          python build_offline_app.py

      # 4. éƒ¨ç½²èˆ‡å°å­˜ç‰ˆæœ¬ (åš´æ ¼æª¢æŸ¥ç‰ˆ)
      - name: Deploy and Archive Version
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

          # ğŸ”´ è¨­å®šä½ ã€Œé æœŸã€è¦ç”¢ç”Ÿçš„æª”å (é€™è£¡è¦è·Ÿ Python è£¡çš„ä¸€æ¨£)
          TARGET_FILE="VocalTrainer_Offline_v27_1.html"

          # æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
          if [ -f "$TARGET_FILE" ]; then
            echo "âœ… æª¢æ¸¬åˆ°ç›®æ¨™æª”æ¡ˆ: $TARGET_FILE"
          else
            echo "âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° $TARGET_FILE ï¼Python å»ºç½®å¯èƒ½å¤±æ•—äº†ã€‚"
            ls -R # åˆ—å‡ºç•¶å‰ç›®éŒ„æ‰€æœ‰æª”æ¡ˆå¹«å¿™é™¤éŒ¯
            exit 1 # å¼·åˆ¶è®“ Action å¤±æ•—
          fi

          # è¤‡è£½ä¸¦éƒ¨ç½²
          cp -f "$TARGET_FILE" index.html

          # åŠ å…¥è¿½è¹¤
          git add "$TARGET_FILE"
          git add index.html

          # æäº¤
          git commit -m "Auto-deploy: $TARGET_FILE" || echo "âš ï¸ æ²’æœ‰è®Šæ›´å¯æäº¤"
          git push
